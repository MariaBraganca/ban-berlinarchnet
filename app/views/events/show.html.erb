<main class= "container min-vh-100">
  <!-- ***************  HEADER EVENT  **************** -->
  <header class="row justify-content-between align-items-end my-5">
    <!-- ***************  INFO  **************** -->
    <section class="col-lg-8">
      <h5 class="corporate mb-3"><%= @event.format[0] %><span class="red"><%= @event.format[1,4] %></span><%= @event.format[5..-1] %></h5>
      <h1 class="font-weight-bold mb-3"><%= @event.title%></h1>
      <div class="d-flex align-items-center mb-3 mb-lg-0"> <!-- USER -->
        <%= link_to user_path(@event.user) do %>
          <% if @event.user.photo.attached? %>
            <%= cl_image_tag(@event.user.photo.key, gravity: :face, :class => "avatar") %>
          <% elsif @event.user.cl_img_tag %>
            <%= cl_image_tag(@event.user.cl_img_tag, gravity: :face, :class => "avatar") %>
          <% else  %>
            <%= cl_image_tag("logo/logo1-gray", gravity: :face, :class => "avatar") %>
          <% end %>
        <% end %>
        <p class="mb-0 pl-3">Hosted by: <%= @event.user.first_name %> <%= @event.user.last_name %></p>
      </div>
    </section>

    <!-- ***************  RSVP  **************** -->    
    <section class="col-lg-4">
      <% if user_signed_in? %>
        <%= link_to "Edit event", edit_event_path(@event), class: "btn btn-call w-100 mb-3" if current_user == @event.user %>
        <% unless @user_attending %>
            <%= render "shared/exampleModal" %>
            <button type="button" class="btn btn-attend w-100" data-toggle="modal" data-target="#exampleModal">
                Attend
            </button>
        <% else%>
            <%= render "shared/deleteModal" %>
            <button type="button" class="btn btn-delete w-100" data-toggle="modal" data-target="#deleteModal">
                Unattend
            </button>
        <% end %>
      <% end %>
    </section>
  </header>
  <hr>
  
  <!-- ***************  CONTENT  **************** -->
  <section class='row my-5'>
    <div class="col-lg-8"> <!-- PHOTO / DESCRIPTION -->
      <% if @event.cover_photo.attached? %> 
          <%= cl_image_tag(@event.cover_photo.key, :class => "cover-img mb-5") %>
      <% else %>
          <%= cl_image_tag(@event.cl_img_tag, :class => "cover-img mb-5") %>
      <% end %>
      <h2 class="mb-3">About</h2>
      <p><%= @event.description %></p>
    </div>
    <div class="col-lg-4"> <!-- MAP / DETAILS -->
      <% unless @event.online %>
        <div class = 'marker mb-5' id="map"
            style="width: 100%; height: 400px;"
            data-markers="<%= @marker.to_json %>"
            data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>">
        </div>
      <% end %>
      <h2 class="mb-3">Details</h2>
      <p><i class="fas fa-calendar-check" style="color: gray"></i> <%= @event.date.strftime('%d. %B, %Y') %> | <%= @event.start_time.strftime('%H:%M') %> to <%= @event.end_time.strftime('%H:%M')%></p>
      <% if @event.online %>
        <p><i class="fas fa-signal" style="color: #90be6d"></i> Online Event</p>                    
        <%= link_to url_for(@event.online_link), :target => '_blank' do %>
            <i class="fas fa-external-link-alt" style="color: #E53E3E"></i> <%= @event.online_link %>
        <% end %>
      <% else%>
        <p><i class="fas fa-building" style="color: #90be6d"></i> <%= @event.venue %></p>
        <p><i class="fas fa-map-marker-alt" style="color: #E53E3E"></i> <%= @event.location %></p>
      <% end %>
    </div>
  </section>

  <!-- ***************  PHOTOS  **************** -->
  <section>
    <h2 class="mb-3">Photos</h2>
    <div id="gallery" data-toggle="modal" data-target="#photoModal">
      <div class="row mb-5">
        <% if @event.cover_photo.attached? %> <!-- COVER PHOTO -->
          <div class ='col-lg-3 mb-3' data-target="#carouselExample" data-slide-to="0">
            <%= cl_image_tag @event.cover_photo.key, :class => 'photos-gallery clickable w-100' %>
          </div>
        <% else %>
          <div class ='col-lg-3 mb-3' data-target="#carouselExample" data-slide-to="0">
            <%= cl_image_tag @event.cl_img_tag, :class => 'photos-gallery clickable w-100' %>
          </div>
        <% end %>
        <% unless @event.event_photos.empty? %> <!-- PHOTOS -->
          <% @event.event_photos.each do |photo| %>
            <div class ='col-lg-3 mb-3' data-target="#carouselExample" data-slide-to="0">
              <%= cl_image_tag photo.key, :class => 'photos-gallery clickable w-100' %>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
    <%= render "shared/photoModal" %> <!-- MODAL -->
  </section>
  <hr>

  <!-- ***************  MEMBERS / COMMENTS  **************** -->
  <section class="row mb-5">

    <!-- ***************  MEMBERS  **************** -->
    <section class='col-lg-6' id = "attending">
      <h2>Attending <span class="badge-number"><%= @event.users.length %></span></h2>
      
      <div class="row mt-3"> <!-- ATTENDING -->
        <% @event.users.each do |user| %>
          <div class="col-6 col-lg-4 text-center mb-3">
            <%= link_to user_path(user) do %>
              <% if user.photo.attached? %>
                <%= cl_image_tag(user.photo.key, gravity: :face, :class => 'avatar-large mb-3') %>
              <%  elsif user.cl_img_tag %>
                <%= cl_image_tag(user.cl_img_tag, gravity: :face, :class => 'avatar-large mb-3') %>
              <% else  %>
                <%= cl_image_tag("logo/logo1-gray", gravity: :face, :class => "avatar-large mb-3") %>
              <% end %>
            <% end %>         
            <p><%= user.first_name %> <%= user.last_name %></p>
          </div>
        <% end %>
      </div>
      
      <% if user_signed_in? %> <!-- RSVP -->
        <% unless @user_attending %>
          <%= render "shared/exampleModal" %>
          <button type="button" class="btn btn-attend mb-5" data-toggle="modal" data-target="#exampleModal">
            Attend
          </button>
        <% else %>
          <%= render "shared/deleteModal" %>
          <button type="button" class="btn btn-delete mb-5" data-toggle="modal" data-target="#deleteModal">
            Unattend
          </button>
        <% end %>
      <% end %>
    </section>

    <!-- ***************  COMMENTS  **************** -->
    <section class='col-lg-6 mb-5'>
      <h2 class="mb-3">Comments <span class="badge-number"><%= @event.comments.length %></span></h2>
      <% @event.comments.each do |comment| %>
        <div class="card-comment mb-3 px-3" id="comment-<%= comment.id %>">
          <% if comment.user.photo.attached? %>
            <%= cl_image_tag(comment.user.photo.key, :class => "avatar-large") %>
          <% elsif comment.user.cl_img_tag %>
            <%= cl_image_tag(comment.user.cl_img_tag, :class => 'avatar-large') %>
          <% else %>
            <%= cl_image_tag("logo/logo1-gray", gravity: :face, :class => "avatar-large") %>
          <% end %>
          <div class="card-infos">
            <p><%= comment.date.strftime("%H:%M | %d.%m.%Y") %> </p>
            <h6><%= comment.content %></h6>
            <p>Posted by: <%= comment.user.first_name %> <%= comment.user.last_name %></p>
          </div>
        </div>
      <% end %>

      <% if user_signed_in? %> <!-- FORM -->
        <div class = "form" id= "comment-form">
          <%= form_tag event_event_comment_path(@event, url: (event_path([@event], anchor:'comments'))), method: :post do |f| %>
            <%= text_field_tag :content %>
            <%= submit_tag 'Post', class: 'btn btn-upload' %>
          <% end %>
        </div>
        <% if flash[:validation]%>
          <div>
            <%= flash[:validation] %>
          </div>
        <% end %>
      <% end %>
    </section>

  </section>
</main>
